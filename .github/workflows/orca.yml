name: ORCA CI
on:
  push:
  pull_request:
  schedule:
    - cron: "0 0 * * *"
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - PSR_MESSAGE_BRIDGE_VERSION: "2.1"
            SYMFONY_VERSION: "5.3"
            SYMFONY_DEPRECATIONS_HELPER: "weak"
            php-version : "8.0"

          - PSR_MESSAGE_BRIDGE_VERSION: "2.1"
            SYMFONY_VERSION: "5.3"
            SYMFONY_DEPRECATIONS_HELPER: "weak"
            php-version: "7.4"

          - PSR_MESSAGE_BRIDGE_VERSION: "2.1"
            SYMFONY_VERSION: "5.3"
            SYMFONY_DEPRECATIONS_HELPER: "weak"
            php-version: "7.3"

          - PSR_MESSAGE_BRIDGE_VERSION: "2.1"
            SYMFONY_VERSION: "4.4"
            php-version: "7.4"

          - PSR_MESSAGE_BRIDGE_VERSION: "2.1"
            SYMFONY_VERSION: "4.4"
            php-version: "7.4"

    steps:
      - uses: actions/checkout@v2

      - uses: actions/setup-node@v2
        with:
          node-version: 12.x

      - uses: shivammathur/setup-php@v2
        with:
          php-version: ${{ matrix.php-version }}
          coverage: none

      - name: Before install
        run: |
          composer self-update

      - name: Install
        run: |
          composer require "symfony/psr-http-message-bridge:${{matrix.PSR_MESSAGE_BRIDGE_VERSION}}" --no-update
          composer require "symfony/security-bundle:${{matrix.SYMFONY_VERSION}}" --no-update
          make install

      - name: Script
        run: |
          make test

